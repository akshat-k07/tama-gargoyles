<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
<!--    This refreshes the page every 30 seconds-->
<!--    <meta http-equiv="refresh" content="30">-->
    <title>Tama Gargoyles – Game</title>
    <link rel="stylesheet" th:href="@{/css/game.css}">
</head>

<body>
<header>
    <h1>Tama Gargoyles</h1>
    <p><strong>Game Screen (MVP)</strong> – virtual time + pause/resume test page</p>
    <hr />
</header>

<!--This adds a time indicator-->
<!--<div class="time-indicator"></div>-->

<main>
    <section>
        <h2 th:text="${gargoyle.name}">Gargoyle Name</h2>


        <!--This is the hourglass code-->

<!--        <div class="hourglass">-->
<!--            <div class="glass top">-->
<!--                <div class="sand sand-top"></div>-->
<!--            </div>-->
<!--            <div class="neck"></div>-->
<!--            <div class="glass bottom">-->
<!--                <div class="sand sand-bottom"></div>-->
<!--            </div>-->
<!--        </div>-->

        <!--This is the stopwatch code-->
        <div class="stopwatch">
            <div class="hand-second"></div>
            <div class="hand-minute"></div>
            <div class="center-dot"></div>
        </div>

        <p>
            <strong>Status:</strong>
            <span th:text="${gargoyle.status}">ACTIVE</span>
            |
            <strong>Type:</strong>
            <span th:text="${gargoyle.type}">CHILD</span>
        </p>

        <p>
            <strong>Paused:</strong>
            <span id="paused" th:text="${gargoyle.paused}">false</span>
        </p>

        <p>
            <strong>Hunger:</strong>
            <span id="hunger" th:text="${gargoyle.hunger}"></span>
            / 100
        </p>

        <p>
            <strong>Happiness:</strong>
            <span id="happiness" th:text="${gargoyle.happiness}"></span>
            / 100
        </p>

        <p>
            <strong>Health:</strong>
            <span id="health" th:text="${gargoyle.health}"></span>
            / 100
        </p>

        <p>
            <strong>Active Minutes (in-game time):</strong>
            <span id="activeMinutes" th:text="${gargoyle.activeMinutes}"></span>
        </p>

        <p>
            <strong>Age (derived):</strong>
            Day <span id="gameDaysOld" th:text="${gameDaysOld}"></span>,
            Minute <span id="minutesIntoDay" th:text="${minutesIntoDay}"></span>
        </p>

        <p>
            <strong>Last Tick:</strong>
            <span th:text="${gargoyle.lastTickAt}">-</span>
        </p>

        <p>
            <strong>Paused At:</strong>
            <span th:text="${gargoyle.pausedAt}">-</span>
        </p>
    </section>

    <hr />

    <section>
        <h3>Actions</h3>

        <!-- Feed - Rocks: requires CSRF token -->
        <form action="/rocks-increase" method="post">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
            <input type="hidden" name="gargoyleId" th:value="${gargoyle.id}"/>
            <input type="hidden" name="strengthDelta" value="10"/>
            <input type="hidden" name="speedDelta" value="-5"/>
            <input type="hidden" name="intelligenceDelta" value="-5"/>
            <input type="hidden" name="hungerDelta" value="10"/>
            <button title="Feed Rocks:
  + Strength
  - Speed
  - Intelligence" type="submit">Feed Rocks</button>
        </form>

        <!-- Feed - Bugs: requires CSRF token -->
        <form action="/bugs-increase" method="post">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
            <input type="hidden" name="gargoyleId" th:value="${gargoyle.id}"/>
            <input type="hidden" name="strengthDelta" value="-5"/>
            <input type="hidden" name="speedDelta" value="10"/>
            <input type="hidden" name="intelligenceDelta" value="-5"/>
            <input type="hidden" name="hungerDelta" value="10"/>
            <button title="Feed Bugs:
  + Speed
  - Strength
  - Intelligence" type="submit">Feed Bugs</button>
        </form>

        <!-- Feed - Fruit: requires CSRF token -->
        <form action="/fruits-increase" method="post">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
            <input type="hidden" name="gargoyleId" th:value="${gargoyle.id}"/>
            <input type="hidden" name="strengthDelta" value="-5"/>
            <input type="hidden" name="speedDelta" value="-5"/>
            <input type="hidden" name="intelligenceDelta" value="10"/>
            <input type="hidden" name="hungerDelta" value="10"/>
            <button title="Feed Fruit:
  + Intelligence
  - Strength
  - Speed" type="submit">Feed Fruit</button>
        </form>

        <!-- Feed - Mystery Food: requires CSRF token -->
        <form action="/mystery-increase" method="post">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
            <input type="hidden" name="gargoyleId" th:value="${gargoyle.id}"/>
            <input type="hidden" name="strengthDelta" value="0"/>
            <input type="hidden" name="speedDelta" value="0"/>
            <input type="hidden" name="intelligenceDelta" value="0"/>
            <input type="hidden" name="hungerDelta" value="10"/>
            <button title="Feed Mystery Food:
  ?????" type="submit">Feed Mystery Food</button>
        </form>

        </br></br>


        <!-- Play - Strength: requires CSRF token -->
        <form action="/strength-increase" method="post">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
            <input type="hidden" name="gargoyleId" th:value="${gargoyle.id}"/>
            <input type="hidden" name="strengthDelta" value="10"/>
            <input type="hidden" name="speedDelta" value="0"/>
            <input type="hidden" name="intelligenceDelta" value="0"/>
            <input type="hidden" name="happinessDelta" value="10"/>
            <button title="Play Strength Game:
  + Strength" type="submit">Play Strength Game</button>
        </form>

        <!-- Play - Speed: requires CSRF token -->
        <form action="/speed-increase" method="post">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
            <input type="hidden" name="gargoyleId" th:value="${gargoyle.id}"/>
            <input type="hidden" name="strengthDelta" value="0"/>
            <input type="hidden" name="speedDelta" value="10"/>
            <input type="hidden" name="intelligenceDelta" value="0"/>
            <input type="hidden" name="happinessDelta" value="10"/>
            <button title="Play Speed Game:
  + Speed" type="submit">Play Speed Game</button>
        </form>

        <!-- Play - Intelligence: requires CSRF token -->
        <form action="/intelligence-increase" method="post">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
            <input type="hidden" name="gargoyleId" th:value="${gargoyle.id}"/>
            <input type="hidden" name="strengthDelta" value="0"/>
            <input type="hidden" name="speedDelta" value="0"/>
            <input type="hidden" name="intelligenceDelta" value="10"/>
            <input type="hidden" name="happinessDelta" value="10"/>
            <button title="Play Intelligence Game:
  + Intelligence" type="submit">Play Intelligence Game</button>
        </form>


        </br></br>

        <!-- Pause (simulate logout): requires CSRF token -->
        <form th:action="@{/gargoyles/pause}" method="post">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
            <button type="submit">Pause (simulate logout)</button>
        </form>

        <!-- Feed: requires CSRF token -->
        <form action="/hunger-increase" method="post">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
            <input type="hidden" name="gargoyleId" th:value="${gargoyle.id}"/>
            <input type="hidden" name="delta" value="10"/>
            <button type="submit">Feed</button>
        </form>

        <form action="/entertainment-increase" method="post">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
            <input type="hidden" name="gargoyleId" th:value="${gargoyle.id}"/>
            <input type="hidden" name="delta" th:value="10"/>
            <button type="submit">Play</button>
        </form>

        <form action="/hunger-decrease" method="post">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
            <input type="hidden" name="gargoyleId" th:value="${gargoyle.id}"/>
            <input type="hidden" name="delta" th:value="10"/>
            <button type="submit">Un-Feed</button>
        </form>

        <form action="/entertainment-decrease" method="post">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
            <input type="hidden" name="gargoyleId" th:value="${gargoyle.id}"/>
            <input type="hidden" name="delta" th:value="10"/>
            <button type="submit">Un-Play</button>
        </form>
        <a th:href="@{/gargoyle/{id}/rename(id=${gargoyle.id})}">Rename</a>
        <p>
            Tip: refresh this page after ~1 minute to see Hunger/Happiness drop
            (only while not paused). If paused, refresh should NOT change them.
            <br>
            <br>
            Note: visiting <code>/game</code> should resume + tick in that order,
            so returning here after being “logged out” won’t apply any offline decay.
        </p>
    </section>
</main>

<footer>
    <hr />
    <p style="font-size: 0.9em;">
        MVP debug view for virtual time. Replace with proper UI later.
    </p>
</footer>
<script th:inline="javascript">
    const gargoyleId = [[${gargoyle.id}]];

    function updateStats() {
        fetch(`/game/stats/${gargoyleId}`)
            .then(res => res.json())
            .then(data => {
                document.getElementById("hunger").textContent = data.hunger;
                document.getElementById("happiness").textContent = data.happiness;
                document.getElementById("health").textContent = data.health;
                document.getElementById("activeMinutes").textContent = data.activeMinutes;
                document.getElementById("gameDaysOld").textContent = data.gameDaysOld;
                document.getElementById("minutesIntoDay").textContent = data.minutesIntoDay;
                document.getElementById("paused").textContent = data.paused;
            })
            .catch(err => console.error("Stat update failed", err));
    }

    // Poll every 5 seconds
    setInterval(updateStats, 5000);
</script>

</body>
</html>
