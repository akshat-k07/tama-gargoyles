<!-- src/main/resources/templates/game.html -->
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tama Gargoyles - Game</title>

    <!-- CSS -->
    <link rel="stylesheet" th:href="@{/css/game.css}" href="/css/game.css" />
</head>

<body>
<main id="main" class="screen">

    <!-- ROW 1: TOP INFO BAR -->
    <header class="hud-top" aria-label="Gargoyle overview">
        <div class="hud-top__left">
            <h1 class="game-title">Tama Gargoyles</h1>

            <div class="meta" aria-label="Creature metadata">
                <span><strong>Creature:</strong> <span th:text="${gargoyle.name}">Pebble</span></span>
                <span><strong>Stage:</strong> <span th:text="${gargoyle.type}">CHILD</span></span>
            </div>
        </div>

        <div class="hud-top__right">
            <div class="meta">
                <span>
                    <strong>Age:</strong>
                    Day <span th:text="${gameDaysOld}">0</span>,
                    Min <span th:text="${minutesIntoDay}">0</span>
                </span>

                <span class="chip"
                      th:classappend="${gargoyle.paused} ? ' chip--warn' : ' chip--ok'">
                    <span th:text="${gargoyle.paused} ? 'PAUSED' : 'RUNNING'">RUNNING</span>
                </span>
            </div>

            <!-- TOP NAV: Rename / Battle / Pause & Exit / Testing mode-->
            <nav class="hud-links" aria-label="Game links">
                <a th:href="@{/gargoyle/{id}/rename(id=${gargoyle.id})}">Rename</a>

                <a th:if="${gargoyle.type.name() == 'GOOD' or gargoyle.type.name() == 'BAD'}"
                   th:href="@{/battle}">
                    Battle
                </a>

                <form th:action="@{/testing-mode/toggle}" method="post" class="hud-links__form">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <button type="submit"
                            class="btn btn--chip"
                            th:classappend="${testingMode} ? ' btn--chip-on' : ' btn--chip-off'"
                            th:attr="aria-pressed=${testingMode}">
                        <span th:text="${testingMode} ? 'üß™ Testing: ON' : 'üß™ Testing: OFF'">üß™ Testing: OFF</span>
                    </button>
                </form>


                <!-- Pause & Exit moved to top -->
                <form class="hud-form" th:action="@{/gargoyles/pause}" method="post">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <button class="nav-btn nav-btn--primary" type="submit" title="Pause the game and return">
                        Pause &amp; Exit
                    </button>
                </form>
            </nav>

            <!-- Optional note stays subtle -->
            <p class="hint hint--top" th:if="${gargoyle.type.name() == 'CHILD'}">
                üîí Battle unlocks when you evolve.
            </p>
        </div>
    </header>

    <!-- ROW 2: CREATURE AREA -->
    <section class="creature-area" aria-labelledby="creature-area-title">
        <h2 id="creature-area-title" class="sr-only">Creature</h2>

        <div class="creature-frame">
            <div class="creature-placeholder bob" aria-hidden="true">
                <span th:text="${gargoyle.type}">CHILD</span>
            </div>

            <p class="overlay overlay--left" th:if="${gargoyle.hunger < 50}">
                ‚ö† Hungry soon
            </p>

            <p class="overlay overlay--right"
               th:if="${gargoyle.hunger >= 60 and gargoyle.happiness >= 60}">
                ‚ú® Well cared for
            </p>
        </div>
    </section>

    <!-- ROW 3: STATS -->
    <section class="stats" aria-label="Stats">

        <!-- Health -->
        <div class="stat">
            <div class="stat__row">
                <span class="stat__label">Health</span>
                <span class="stat__value" th:text="${gargoyle.health} + '%'">90%</span>
            </div>

            <div class="meter"
                 th:classappend="${gargoyle.health < 25} ? ' meter--danger' : (${gargoyle.health < 50} ? ' meter--warn' : '')">
                <div class="meter__fill" th:style="'width:' + ${gargoyle.health} + '%'"></div>
            </div>

            <span class="sr-only"
                  th:text="${gargoyle.health < 25 ? 'Critical' : (gargoyle.health < 50 ? 'Warning' : 'OK')}">OK</span>
        </div>

        <!-- Hunger -->
        <div class="stat">
            <div class="stat__row">
                <span class="stat__label">Hunger</span>
                <span class="stat__value" th:text="${gargoyle.hunger} + '%'">62%</span>
            </div>

            <div class="meter"
                 th:classappend="${gargoyle.hunger < 25} ? ' meter--danger' : (${gargoyle.hunger < 50} ? ' meter--warn' : '')">
                <div class="meter__fill" th:style="'width:' + ${gargoyle.hunger} + '%'"></div>
            </div>

            <span class="sr-only"
                  th:text="${gargoyle.hunger < 25 ? 'Critical' : (gargoyle.hunger < 50 ? 'Warning' : 'OK')}">OK</span>
        </div>

        <!-- Happiness -->
        <div class="stat">
            <div class="stat__row">
                <span class="stat__label">Happiness</span>
                <span class="stat__value" th:text="${gargoyle.happiness} + '%'">80%</span>
            </div>

            <div class="meter"
                 th:classappend="${gargoyle.happiness < 25} ? ' meter--danger' : (${gargoyle.happiness < 50} ? ' meter--warn' : '')">
                <div class="meter__fill" th:style="'width:' + ${gargoyle.happiness} + '%'"></div>
            </div>

            <span class="sr-only"
                  th:text="${gargoyle.happiness < 25 ? 'Critical' : (gargoyle.happiness < 50 ? 'Warning' : 'OK')}">OK</span>
        </div>
    </section>

    <!-- ROW 4: ACTIONS -->
    <section class="actions" aria-label="Actions">

        <!-- FEED -->
        <div class="actions__group actions__group--feed" aria-labelledby="feed-title">
            <h3 id="feed-title">Feed</h3>
            <p class="actions__sub">Pick a snack to shape your gargoyle‚Äôs growth ‚ú®</p>

            <div class="actions__icons" role="group" aria-label="Feed options">

                <form action="/rocks-increase" method="post">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <input type="hidden" name="gargoyleId" th:value="${gargoyle.id}"/>
                    <input type="hidden" name="strengthDelta" value="10"/>
                    <input type="hidden" name="speedDelta" value="-5"/>
                    <input type="hidden" name="intelligenceDelta" value="-5"/>
                    <input type="hidden" name="hungerDelta" value="10"/>
                    <button class="icon-btn icon-btn--feed" type="submit" title="Feed Rocks: +Strength, -Speed, -Intelligence" aria-label="Feed Rocks">
                        <span class="icon" aria-hidden="true">ü™®</span>
                        <span class="sr-only">Feed Rocks</span>
                    </button>
                    <div class="icon-label" aria-hidden="true">Rocks</div>
                </form>

                <form action="/bugs-increase" method="post">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <input type="hidden" name="gargoyleId" th:value="${gargoyle.id}"/>
                    <input type="hidden" name="strengthDelta" value="-5"/>
                    <input type="hidden" name="speedDelta" value="10"/>
                    <input type="hidden" name="intelligenceDelta" value="-5"/>
                    <input type="hidden" name="hungerDelta" value="10"/>
                    <button class="icon-btn icon-btn--feed" type="submit" title="Feed Bugs: +Speed, -Strength, -Intelligence" aria-label="Feed Bugs">
                        <span class="icon" aria-hidden="true">üêõ</span>
                        <span class="sr-only">Feed Bugs</span>
                    </button>
                    <div class="icon-label" aria-hidden="true">Bugs</div>
                </form>

                <form action="/fruits-increase" method="post">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <input type="hidden" name="gargoyleId" th:value="${gargoyle.id}"/>
                    <input type="hidden" name="strengthDelta" value="-5"/>
                    <input type="hidden" name="speedDelta" value="-5"/>
                    <input type="hidden" name="intelligenceDelta" value="10"/>
                    <input type="hidden" name="hungerDelta" value="10"/>
                    <button class="icon-btn icon-btn--feed" type="submit" title="Feed Fruit: +Intelligence, -Strength, -Speed" aria-label="Feed Fruit">
                        <span class="icon" aria-hidden="true">üçé</span>
                        <span class="sr-only">Feed Fruit</span>
                    </button>
                    <div class="icon-label" aria-hidden="true">Fruit</div>
                </form>

                <form action="/mystery-increase" method="post">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <input type="hidden" name="gargoyleId" th:value="${gargoyle.id}"/>
                    <input type="hidden" name="strengthDelta" value="0"/>
                    <input type="hidden" name="speedDelta" value="0"/>
                    <input type="hidden" name="intelligenceDelta" value="0"/>
                    <input type="hidden" name="hungerDelta" value="10"/>
                    <button class="icon-btn icon-btn--mystery" type="submit" title="Feed Mystery Food: ???" aria-label="Feed Mystery">
                        <span class="icon" aria-hidden="true">‚ùì</span>
                        <span class="sr-only">Feed Mystery</span>
                    </button>
                    <div class="icon-label" aria-hidden="true">Mystery</div>
                </form>

            </div>
        </div>

        <!-- PLAY -->
        <div class="actions__group actions__group--play" aria-labelledby="play-title">
            <h3 id="play-title">Play</h3>
            <p class="actions__sub">Mini-games boost happiness (and sometimes stats!)</p>

            <div class="actions__icons" role="group" aria-label="Play options">

                <form action="/strength-increase" method="post">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <input type="hidden" name="gargoyleId" th:value="${gargoyle.id}"/>
                    <input type="hidden" name="strengthDelta" value="10"/>
                    <input type="hidden" name="speedDelta" value="0"/>
                    <input type="hidden" name="intelligenceDelta" value="0"/>
                    <input type="hidden" name="happinessDelta" value="10"/>
                    <button class="icon-btn icon-btn--play" type="submit" title="Strength Game: +Strength" aria-label="Play Strength game">
                        <span class="icon" aria-hidden="true">üí™</span>
                        <span class="sr-only">Strength</span>
                    </button>
                    <div class="icon-label" aria-hidden="true">Strength</div>
                </form>

                <form action="/speed-increase" method="post">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <input type="hidden" name="gargoyleId" th:value="${gargoyle.id}"/>
                    <input type="hidden" name="strengthDelta" value="0"/>
                    <input type="hidden" name="speedDelta" value="10"/>
                    <input type="hidden" name="intelligenceDelta" value="0"/>
                    <input type="hidden" name="happinessDelta" value="10"/>
                    <button class="icon-btn icon-btn--play" type="submit" title="Speed Game: +Speed" aria-label="Play Speed game">
                        <span class="icon" aria-hidden="true">‚ö°</span>
                        <span class="sr-only">Speed</span>
                    </button>
                    <div class="icon-label" aria-hidden="true">Speed</div>
                </form>

                <form action="/intelligence-increase" method="post">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <input type="hidden" name="gargoyleId" th:value="${gargoyle.id}"/>
                    <input type="hidden" name="strengthDelta" value="0"/>
                    <input type="hidden" name="speedDelta" value="0"/>
                    <input type="hidden" name="intelligenceDelta" value="10"/>
                    <input type="hidden" name="happinessDelta" value="10"/>
                    <button class="icon-btn icon-btn--play" type="submit" title="Brains Game: +Intelligence" aria-label="Play Brains game">
                        <span class="icon" aria-hidden="true">üß†</span>
                        <span class="sr-only">Brains</span>
                    </button>
                    <div class="icon-label" aria-hidden="true">Brains</div>
                </form>

            </div>
        </div>

        <!-- RIGHT COLUMN: quick note / future slot -->
        <aside class="actions__group actions__group--side" aria-label="Tips">
            <h3>Tip</h3>
            <p class="hint">
                Try different combos. Your gargoyle‚Äôs vibe will emerge over time ‚ú®
            </p>
        </aside>

    </section>

    <!-- ROW 5: EVENT LOG -->
    <section class="log" aria-label="Event log">
        <h3>Event Log</h3>

        <ul class="log__list">
            <li th:if="${flashMessage}" th:text="${flashMessage}">You fed your gargoyle!</li>
            <li th:unless="${flashMessage}">Tip: refresh after ~1 minute to see decay while RUNNING.</li>
            <li th:if="${gargoyle.type.name() == 'CHILD'}">Battle unlocks when you become an adult.</li>
        </ul>

        <!-- Debug only when devMode == true -->
        <details class="debug" th:if="${devMode}">
            <summary>Debug</summary>
            <p><strong>Last Tick:</strong> <span th:text="${gargoyle.lastTickAt}">-</span></p>
            <p><strong>Paused At:</strong> <span th:text="${gargoyle.pausedAt}">-</span></p>
            <p><strong>Active Minutes:</strong> <span th:text="${gargoyle.activeMinutes}">0</span></p>
        </details>
    </section>

</main>
</body>
</html>
